import{r as u,f as q,c as r,o as i,b as e,l as k,a as A,s as P,F,h as T,J,t as x,O as N,k as G,q as H,e as I,K as W,i as X,p as Y}from"./vue-DFkF7ryY.js";import{u as Z}from"./user-fB6NIROl.js";import{u as ee}from"./order-BwTiizuj.js";import{d as te}from"./index-DqYNpIz3.js";import"./vendor-BtuGy7By.js";const se={class:"relative w-full"},le={key:0,class:"absolute z-10 w-full bg-white border rounded shadow max-h-60 overflow-y-auto"},ae=["onClick"],ne={__name:"SearchableDropdown",props:{products:{type:Array,required:!0},onSelect:{type:Function,default:()=>{}}},setup(M){const S=M,g=u(""),p=u(!1);function f(m){const n={"০":"0","১":"1","২":"2","৩":"3","৪":"4","৫":"5","৬":"6","৭":"7","৮":"8","৯":"9"};return m.replace(/[০-৯]/g,a=>n[a])}const o=q(()=>(g.value?S.products.filter(n=>{const a=f(g.value);return parseInt(n.id)===parseInt(a)||n.name.toLowerCase().includes(g.value.toLowerCase())}):S.products).sort((n,a)=>n.id-a.id));function c(m){S.onSelect(m),g.value="",p.value=!1}function v(){setTimeout(()=>p.value=!1,200)}return(m,n)=>(i(),r("div",se,[n[2]||(n[2]=e("label",{class:"block text-sm font-medium mb-2"},"পণ্য নির্বাচন করুন",-1)),k(e("input",{type:"text","onUpdate:modelValue":n[0]||(n[0]=a=>g.value=a),onFocus:n[1]||(n[1]=a=>p.value=!0),onBlur:v,placeholder:"পণ্য সার্চ করুন...",class:"w-full p-2 border rounded"},null,544),[[P,g.value]]),p.value&&o.value.length?(i(),r("ul",le,[(i(!0),r(F,null,T(o.value,a=>(i(),r("li",{key:a.id,onClick:J(_=>c(a),["self"]),class:"p-2 cursor-pointer hover:bg-gray-100"},x(a.id)+" | "+x(a.name)+" - ৳"+x(a.selling_price),9,ae))),128))])):A("",!0)]))}},oe={class:"grid gap-2 p-4 bg-gray-100 rounded-md border"},ue={class:"grid md:grid-cols-7 gap-2"},re={class:"relative"},ie={key:0,class:"fas fa-search"},de={key:1,class:"fad fa-spinner animate-spin"},ce={class:"md:col-span-2"},ve={class:"relative"},me={key:0,class:"fas fa-search"},pe={key:1,class:"fad fa-spinner animate-spin"},fe={class:"md:col-span-4"},ye={key:0,class:"text-green-500 text-center text-sm"},xe={key:1,class:"text-red-500 text-center text-sm"},be={key:2,class:"flex flex-col justify-center items-center gap-2"},ge={key:1,class:"fad fa-spinner animate-spin text-white"},_e={__name:"UserSearch",emits:["user-selected","user-created"],setup(M,{expose:S,emit:g}){const p=Z(),f=u(!1),o=u(""),c=u(""),v=u(""),m=u(""),n=u(""),a=u(""),_=u("search"),w=u(null),C=g,j=()=>{v.value="",m.value="",n.value="",a.value="",_.value="create",o.value="",c.value=""},b=async()=>{f.value=!0,o.value="",c.value="";try{const l=await p.searchUser({id:v.value});(l==null?void 0:l.status)==="found"?(D(p.user),o.value="ক্রেতা পাওয়া গেছে!😍",C("user-selected",p.user)):(c.value="ক্রেতা পাওয়া যায়নি!😢 ক্রেতা তৈরী করুন",v.value="",n.value="",a.value="",_.value="create")}catch(l){c.value="ত্রুটি পাওয়া গেছে!😭",console.error("ত্রুটি পাওয়া গেছে!😭",l)}finally{f.value=!1}},U=async()=>{f.value=!0,o.value="",c.value="";try{const l=await p.searchUser({phone:m.value});(l==null?void 0:l.status)==="found"?(D(p.user),o.value="ক্রেতা পাওয়া গেছে!😍",C("user-selected",p.user)):(c.value="ক্রেতা পাওয়া যায়নি!😢 ক্রেতা তৈরী করুন",v.value="",n.value="",a.value="",_.value="create")}catch(l){c.value="ত্রুটি পাওয়া গেছে!😭",console.error("ত্রুটি পাওয়া গেছে!😭",l),_.value="create"}finally{f.value=!1}},V=async()=>{f.value=!0,o.value="",c.value="",w.value=null;try{const l={phone:m.value,name:n.value,address:a.value},y=await p.addUser(l);D(y),w.value=y,o.value="সফলভাবে ক্রেতা তৈরি হয়েছে!🤩",C("user-created",y),_.value="edit"}catch(l){c.value=(l==null?void 0:l.message)||"ক্রেতা তৈরি করা যায়নি!😢",console.error("Error:",l)}finally{f.value=!1}},D=l=>{v.value=l.id||"",m.value=l.phone||"",n.value=l.name||"",a.value=l.address||"",_.value="edit"};return S({resetForm:j}),(l,y)=>(i(),r("div",oe,[e("div",ue,[e("div",null,[e("div",re,[k(e("input",{"onUpdate:modelValue":y[0]||(y[0]=$=>v.value=$),type:"text",class:"input-1 w-full text-black px-3 py-1",placeholder:"ID",onKeyup:N(b,["enter"])},null,544),[[P,v.value]]),v.value?(i(),r("button",{key:0,onClick:b,class:"absolute right-3 top-2"},[f.value?(i(),r("i",de)):(i(),r("i",ie))])):A("",!0)])]),e("div",ce,[e("div",ve,[k(e("input",{"onUpdate:modelValue":y[1]||(y[1]=$=>m.value=$),type:"text",class:"input-1 w-full text-black px-3 py-1",placeholder:"ফোন",onKeyup:N(U,["enter"])},null,544),[[P,m.value]]),m.value?(i(),r("button",{key:0,onClick:U,class:"absolute right-3 top-2"},[f.value?(i(),r("i",pe)):(i(),r("i",me))])):A("",!0)])]),e("div",fe,[k(e("input",{"onUpdate:modelValue":y[2]||(y[2]=$=>n.value=$),type:"text",placeholder:"নাম",class:"input-1 w-full text-black px-3 py-1"},null,512),[[P,n.value]])])]),e("div",null,[k(e("input",{"onUpdate:modelValue":y[3]||(y[3]=$=>a.value=$),type:"text",placeholder:"ঠিকানা",class:"input-1 w-full text-black px-3 py-1"},null,512),[[P,a.value]])]),o.value?(i(),r("div",ye,x(o.value),1)):A("",!0),c.value?(i(),r("div",xe,x(c.value),1)):A("",!0),_.value==="create"?(i(),r("div",be,[f.value?(i(),r("i",ge)):(i(),r("button",{key:0,class:"btn-2",onClick:V},"Create User"))])):A("",!0)]))}},he={class:"my-container space-y-4"},ke={key:0,class:"text-red-600 text-center"},we={class:"bg-white shadow p-4 rounded-lg space-y-4"},Ce={key:0,class:"grid gap-2"},Ue={class:"flex items-center gap-4"},$e=["src"],Pe={class:"text-lg font-semibold text-gray-800 mb-2"},Se={class:"text-sm text-gray-600"},De={class:"flex justify-between items-center"},Ae={class:"flex flex-col items-center"},je={class:"flex items-center gap-2"},Ve=["onClick","disabled"],qe=["value","onInput"],Me=["onClick"],Oe={class:"flex flex-col items-end"},Be={class:"text-lg font-bold text-gray-800"},Fe=["onClick"],Te={key:1,class:"text-center text-red-500 text-sm bg-gray-50 p-4 rounded-lg border"},Le={class:"grid md:grid-cols-2 gap-4"},Ne={class:""},Ie={class:"divide-y"},Ee={class:"flex justify-between items-center"},Ke={id:"discount-options"},Qe=["value"],Re={class:"flex justify-between items-center"},ze={class:"text-lg font-semibold text-gray-800"},Je={class:"flex justify-between items-center"},Ge={class:"text-lg font-semibold text-violet-600"},He={class:"flex justify-between items-center"},We={class:"text-lg font-semibold text-blue-600"},Xe={class:"flex justify-between items-center"},Ye={class:"flex justify-between items-center"},Ze={class:"text-lg font-semibold text-red-600"},et={class:"flex justify-between items-center"},tt={class:"flex justify-between items-center"},st={class:"flex flex-col items-center"},lt=["disabled"],at="offline",dt={__name:"OrderCreate",setup(M){const S=X(),g=ee(),p=te(),f=u([]),o=u([]),c=u(""),v=u(0),m=u(0),n=u(!1),a=u(null),_=[0,5,10,12,15,20,25,30,35,40,45,50],w=u(0),C=u("Cash"),j=u(""),b=u(0),U=u(0),V=u(null),D=q(()=>v.value*w.value/100),l=q(()=>v.value-D.value-U.value),y=q(()=>{const d=m.value+b.value,t=l.value-d;return t>0?t:0}),$=async()=>{try{n.value=!0,await p.fetchProducts(),f.value=p.products}catch(d){a.value=d.message}finally{n.value=!1}};G(()=>{$(),b.value=l.value}),H([w,U],()=>{b.value=l.value});const O=()=>{v.value=o.value.reduce((d,t)=>d+t.quantity*t.selling_price,0)},E=d=>{o.value.find(t=>t.id===d.id)||(o.value.push({...d,quantity:1}),O())},B=(d,t)=>{const s=o.value.find(h=>h.id===d);s&&(s.quantity=t,O())},K=d=>{o.value=o.value.filter(t=>t.id!==d),O()},Q=async()=>{var d,t;try{n.value=!0;const s=await g.createOrder({user_id:c.value,type:at,products:o.value.map(h=>({product_id:h.id,quantity:h.quantity,price:h.selling_price})),discount_percentage:w.value,discount_amount:D.value,adjust_amount:U.value,payable_amount:l.value,payment:{amount:b.value,method:C.value,remarks:j.value}});S.push({name:"OrderDetails",params:{id:s.id}}),R()}catch(s){a.value=((t=(d=s.response)==null?void 0:d.data)==null?void 0:t.message)||"Failed to create order"}finally{n.value=!1}},R=()=>{c.value=null,o.value=[],v.value=0,m.value=0,w.value=0,U.value=0,b.value=0,C.value="",j.value="",V.value&&V.value.reset()},L=d=>{c.value=d.id,console.log("Selected User:",d)},z=q(()=>f.value.filter(d=>!o.value.some(t=>t.id===d.id)));return(d,t)=>(i(),r("div",he,[t[25]||(t[25]=e("h1",{class:"text-2xl font-bold mb-4"},"অর্ডার তৈরী করুন",-1)),a.value?(i(),r("div",ke,x(a.value),1)):A("",!0),e("div",we,[e("div",null,[t[5]||(t[5]=e("p",{class:"font-bold"},"ক্রেতার তথ্য",-1)),I(_e,{ref_key:"userSearch",ref:V,onUserCreated:L,onUserSelected:L},null,512)]),I(ne,{products:z.value,onSelect:s=>{E(s)}},null,8,["products","onSelect"]),t[24]||(t[24]=e("h3",{class:"text-lg font-medium text-center"},"নির্বাচিত পণ্য",-1)),o.value.length>0?(i(),r("div",Ce,[(i(!0),r(F,null,T(o.value,s=>(i(),r("div",{key:s.id,class:"border rounded-lg p-2 bg-gray-50 grid md:grid-cols-2 gap-4"},[e("div",Ue,[e("img",{src:s.photo,alt:"",class:"w-12 shadow-sm rounded-md"},null,8,$e),e("div",null,[e("h4",Pe,x(s.name),1),e("p",Se,[t[6]||(t[6]=e("span",{class:"font-medium"},"বিক্রয় মূল্য:",-1)),Y(" ৳"+x(Number(s.selling_price).toLocaleString("bn-BD")),1)])])]),e("div",De,[e("div",Ae,[t[9]||(t[9]=e("p",{class:"text-sm font-medium text-gray-600"},"Quantity:",-1)),e("div",je,[e("button",{class:"btn-icon",onClick:h=>B(s.id,Math.max(s.quantity-1,1)),disabled:s.quantity<=1},t[7]||(t[7]=[e("i",{class:"fas fa-minus"},null,-1)]),8,Ve),e("input",{type:"number",class:"w-14 text-center py-1 rounded border",value:s.quantity,onInput:h=>B(s.id,Math.max(h.target.value,1))},null,40,qe),e("button",{class:"btn-icon",onClick:h=>B(s.id,s.quantity+1)},t[8]||(t[8]=[e("i",{class:"fas fa-plus"},null,-1)]),8,Me)])]),e("div",Oe,[t[10]||(t[10]=e("p",{class:"text-sm font-medium text-gray-600"},"Total:",-1)),e("p",Be," ৳"+x(s.quantity*s.selling_price),1)]),e("button",{class:"btn-icon",onClick:h=>K(s.id)},t[11]||(t[11]=[e("i",{class:"fas fa-trash text-red-500"},null,-1)]),8,Fe)])]))),128))])):(i(),r("div",Te,t[12]||(t[12]=[e("p",null,"কোন পণ্য সিলেক্ট করা নেই",-1)]))),e("div",Le,[e("div",Ne,[t[13]||(t[13]=e("p",{class:"text-sm font-medium text-gray-600 mb-1"},"Remarks",-1)),k(e("textarea",{"onUpdate:modelValue":t[0]||(t[0]=s=>j.value=s),placeholder:"Enter remarks",class:"w-full p-2 bg-gray-50 rounded-md border"},null,512),[[P,j.value]])]),e("div",Ie,[e("div",Ee,[t[14]||(t[14]=e("label",{class:"text-sm font-medium text-gray-600 mb-1"},"Discount Percentage (%)",-1)),k(e("input",{list:"discount-options","onUpdate:modelValue":t[1]||(t[1]=s=>w.value=s),type:"number",class:"bg-gray-50 p-1 border",placeholder:"Discount %"},null,512),[[P,w.value]]),e("datalist",Ke,[(i(),r(F,null,T(_,s=>e("option",{key:s,value:s},null,8,Qe)),64))])]),t[23]||(t[23]=e("h3",{class:"text-xl font-semibold mb-4 text-gray-800 pt-4"},"Payment Details",-1)),e("div",Re,[t[15]||(t[15]=e("p",{class:"text-sm font-medium text-gray-600 mb-1"},"Total Price",-1)),e("p",ze,"৳ "+x(v.value),1)]),e("div",Je,[t[16]||(t[16]=e("p",{class:"text-sm font-medium text-gray-600 mb-1"},"Discount Amount",-1)),e("p",Ge,"৳ "+x(D.value),1)]),e("div",He,[t[17]||(t[17]=e("p",{class:"text-sm font-medium text-gray-600 mb-1"},"Payable Amount",-1)),e("p",We,"৳ "+x(l.value),1)]),e("div",Xe,[t[18]||(t[18]=e("label",{class:"text-sm font-medium text-gray-600 mb-1"},"Payment Amount",-1)),k(e("input",{type:"number","onUpdate:modelValue":t[2]||(t[2]=s=>b.value=s),class:"text-end bg-gray-50 p-1 w-[100px] border",placeholder:"Amount"},null,512),[[P,b.value]])]),e("div",Ye,[t[19]||(t[19]=e("p",{class:"text-sm font-medium text-gray-600 mb-1"},"Due Amount",-1)),e("p",Ze,"৳ "+x(y.value),1)]),e("div",et,[t[21]||(t[21]=e("label",{class:"text-sm font-medium text-gray-600 mb-1"},"Payment Method",-1)),k(e("select",{"onUpdate:modelValue":t[3]||(t[3]=s=>C.value=s),class:"bg-gray-100 p-1"},t[20]||(t[20]=[e("option",{value:"Cash"},"Cash",-1),e("option",{value:"Card"},"Card",-1),e("option",{value:"Mobile Banking"},"Mobile Banking",-1),e("option",{value:"Other"},"Other",-1)]),512),[[W,C.value]])]),e("div",tt,[t[22]||(t[22]=e("p",{class:"text-sm font-medium text-gray-600 mb-1"},"Adjustment",-1)),k(e("input",{type:"number","onUpdate:modelValue":t[4]||(t[4]=s=>U.value=s),class:"text-end bg-gray-50 p-1 w-[100px] border",placeholder:"Adjustment"},null,512),[[P,U.value]])])])]),e("div",st,[e("button",{onClick:Q,class:"btn-2",disabled:!c.value||o.value.length===0||b.value<0||!C.value}," Create Order & Add Payment ",8,lt)])])]))}};export{dt as default};
