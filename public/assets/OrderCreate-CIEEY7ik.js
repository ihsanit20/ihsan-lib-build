import{h as a,o as u,c as i,a as e,j as _,v as P,I as N,e as D,t as y,x as H,B as A,l as W,J as X,f as Y,y as L,F,r as T,d as Z,k as ee}from"./index-B9QrrNei.js";import{u as te}from"./user-B_iqrEPK.js";import{u as se}from"./order-6XUB2gLw.js";const le={class:"grid gap-2 p-4 bg-gray-100 rounded-md border"},ae={class:"grid md:grid-cols-7 gap-2"},ne={class:"relative"},oe={key:0,class:"fas fa-search"},ue={key:1,class:"fad fa-spinner animate-spin"},ie={class:"md:col-span-2"},re={class:"relative"},de={key:0,class:"fas fa-search"},ce={key:1,class:"fad fa-spinner animate-spin"},ve={class:"md:col-span-4"},me={key:0,class:"text-green-500 text-center text-sm"},pe={key:1,class:"text-red-500 text-center text-sm"},ye={key:2,class:"flex flex-col justify-center items-center gap-2"},fe={key:1,class:"fad fa-spinner animate-spin text-white"},xe={__name:"UserSearch",emits:["user-selected","user-created"],setup(E,{expose:M,emit:q}){const x=te(),v=a(!1),n=a(""),r=a(""),d=a(""),b=a(""),m=a(""),p=a(""),h=a("search"),k=a(null),w=q,j=()=>{d.value="",b.value="",m.value="",p.value="",h.value="create",n.value="",r.value=""},f=async()=>{v.value=!0,n.value="",r.value="";try{const l=await x.searchUser({id:d.value});(l==null?void 0:l.status)==="found"?($(x.user),n.value="à¦•à§à¦°à§‡à¦¤à¦¾ à¦ªà¦¾à¦“à§Ÿà¦¾ à¦—à§‡à¦›à§‡!ðŸ˜",w("user-selected",x.user)):(r.value="à¦•à§à¦°à§‡à¦¤à¦¾ à¦ªà¦¾à¦“à§Ÿà¦¾ à¦¯à¦¾à§Ÿà¦¨à¦¿!ðŸ˜¢ à¦•à§à¦°à§‡à¦¤à¦¾ à¦¤à§ˆà¦°à§€ à¦•à¦°à§à¦¨",d.value="",m.value="",p.value="",h.value="create")}catch(l){r.value="à¦¤à§à¦°à§à¦Ÿà¦¿ à¦ªà¦¾à¦“à§Ÿà¦¾ à¦—à§‡à¦›à§‡!ðŸ˜­",console.error("à¦¤à§à¦°à§à¦Ÿà¦¿ à¦ªà¦¾à¦“à§Ÿà¦¾ à¦—à§‡à¦›à§‡!ðŸ˜­",l)}finally{v.value=!1}},U=async()=>{v.value=!0,n.value="",r.value="";try{const l=await x.searchUser({phone:b.value});(l==null?void 0:l.status)==="found"?($(x.user),n.value="à¦•à§à¦°à§‡à¦¤à¦¾ à¦ªà¦¾à¦“à§Ÿà¦¾ à¦—à§‡à¦›à§‡!ðŸ˜",w("user-selected",x.user)):(r.value="à¦•à§à¦°à§‡à¦¤à¦¾ à¦ªà¦¾à¦“à§Ÿà¦¾ à¦¯à¦¾à§Ÿà¦¨à¦¿!ðŸ˜¢ à¦•à§à¦°à§‡à¦¤à¦¾ à¦¤à§ˆà¦°à§€ à¦•à¦°à§à¦¨",d.value="",m.value="",p.value="",h.value="create")}catch(l){r.value="à¦¤à§à¦°à§à¦Ÿà¦¿ à¦ªà¦¾à¦“à§Ÿà¦¾ à¦—à§‡à¦›à§‡!ðŸ˜­",console.error("à¦¤à§à¦°à§à¦Ÿà¦¿ à¦ªà¦¾à¦“à§Ÿà¦¾ à¦—à§‡à¦›à§‡!ðŸ˜­",l),h.value="create"}finally{v.value=!1}},S=async()=>{v.value=!0,n.value="",r.value="",k.value=null;try{const l={phone:b.value,name:m.value,address:p.value},c=await x.addUser(l);$(c),k.value=c,n.value="à¦¸à¦«à¦²à¦­à¦¾à¦¬à§‡ à¦•à§à¦°à§‡à¦¤à¦¾ à¦¤à§ˆà¦°à¦¿ à¦¹à§Ÿà§‡à¦›à§‡!ðŸ¤©",w("user-created",c),h.value="edit"}catch(l){r.value=(l==null?void 0:l.message)||"à¦•à§à¦°à§‡à¦¤à¦¾ à¦¤à§ˆà¦°à¦¿ à¦•à¦°à¦¾ à¦¯à¦¾à§Ÿà¦¨à¦¿!ðŸ˜¢",console.error("Error:",l)}finally{v.value=!1}},$=l=>{d.value=l.id||"",b.value=l.phone||"",m.value=l.name||"",p.value=l.address||"",h.value="edit"};return M({resetForm:j}),(l,c)=>(u(),i("div",le,[e("div",ae,[e("div",null,[e("div",ne,[_(e("input",{"onUpdate:modelValue":c[0]||(c[0]=C=>d.value=C),type:"text",class:"input-1 w-full text-black px-3 py-1",placeholder:"ID",onKeyup:N(f,["enter"])},null,544),[[P,d.value]]),d.value?(u(),i("button",{key:0,onClick:f,class:"absolute right-3 top-2"},[v.value?(u(),i("i",ue)):(u(),i("i",oe))])):D("",!0)])]),e("div",ie,[e("div",re,[_(e("input",{"onUpdate:modelValue":c[1]||(c[1]=C=>b.value=C),type:"text",class:"input-1 w-full text-black px-3 py-1",placeholder:"à¦«à§‹à¦¨",onKeyup:N(U,["enter"])},null,544),[[P,b.value]]),b.value?(u(),i("button",{key:0,onClick:U,class:"absolute right-3 top-2"},[v.value?(u(),i("i",ce)):(u(),i("i",de))])):D("",!0)])]),e("div",ve,[_(e("input",{"onUpdate:modelValue":c[2]||(c[2]=C=>m.value=C),type:"text",placeholder:"à¦¨à¦¾à¦®",class:"input-1 w-full text-black px-3 py-1"},null,512),[[P,m.value]])])]),e("div",null,[_(e("input",{"onUpdate:modelValue":c[3]||(c[3]=C=>p.value=C),type:"text",placeholder:"à¦ à¦¿à¦•à¦¾à¦¨à¦¾",class:"input-1 w-full text-black px-3 py-1"},null,512),[[P,p.value]])]),n.value?(u(),i("div",me,y(n.value),1)):D("",!0),r.value?(u(),i("div",pe,y(r.value),1)):D("",!0),h.value==="create"?(u(),i("div",ye,[v.value?(u(),i("i",fe)):(u(),i("button",{key:0,class:"btn-2",onClick:S},"Create User"))])):D("",!0)]))}},be={class:"my-container space-y-4"},ge={key:0,class:"text-red-600 text-center"},_e={class:"bg-white shadow p-4 rounded-lg space-y-4"},he=["value"],ke={key:0,class:"grid gap-2"},we={class:"flex items-center gap-4"},Ue=["src"],Ce={class:"text-lg font-semibold text-gray-800 mb-2"},Pe={class:"text-sm text-gray-600"},$e={class:"flex justify-between items-center"},je={class:"flex flex-col items-center"},De={class:"flex items-center gap-2"},Se=["onClick","disabled"],Ve=["value","onInput"],Ae=["onClick"],Me={class:"flex flex-col items-end"},qe={class:"text-lg font-bold text-gray-800"},Be=["onClick"],Oe={key:1,class:"text-center text-red-500 text-sm bg-gray-50 p-4 rounded-lg border"},Fe={class:"grid md:grid-cols-2 gap-4"},Te={class:""},Ie={class:"divide-y"},Ne={class:"flex justify-between items-center"},Le={id:"discount-options"},Ee=["value"],Ke={class:"flex justify-between items-center"},Re={class:"text-lg font-semibold text-gray-800"},Qe={class:"flex justify-between items-center"},Je={class:"text-lg font-semibold text-violet-600"},ze={class:"flex justify-between items-center"},Ge={class:"text-lg font-semibold text-blue-600"},He={class:"flex justify-between items-center"},We={class:"flex justify-between items-center"},Xe={class:"text-lg font-semibold text-red-600"},Ye={class:"flex justify-between items-center"},Ze={class:"flex justify-between items-center"},et={class:"flex flex-col items-center"},tt=["disabled"],st="offline",ot={__name:"OrderCreate",setup(E){const M=ee(),q=se(),x=H(),v=a([]),n=a([]),r=a(""),d=a(0),b=a(0),m=a(!1),p=a(null),h=[0,5,10,12,15,20,25,30,35,40,45,50],k=a(0),w=a("Cash"),j=a(""),f=a(0),U=a(0),S=a(null),$=A(()=>d.value*k.value/100),l=A(()=>d.value-$.value-U.value),c=A(()=>{const o=b.value+f.value,t=l.value-o;return t>0?t:0}),C=async()=>{try{m.value=!0,await x.fetchProducts(),v.value=x.products}catch(o){p.value=o.message}finally{m.value=!1}};W(()=>{C(),f.value=l.value}),X([k,U],()=>{f.value=l.value});const B=()=>{d.value=n.value.reduce((o,t)=>o+t.quantity*t.selling_price,0)},K=o=>{n.value.find(t=>t.id===o.id)||(n.value.push({...o,quantity:1}),B())},O=(o,t)=>{const s=n.value.find(g=>g.id===o);s&&(s.quantity=t,B())},R=o=>{n.value=n.value.filter(t=>t.id!==o),B()},Q=async()=>{var o,t;try{m.value=!0;const s=await q.createOrder({user_id:r.value,type:st,products:n.value.map(g=>({product_id:g.id,quantity:g.quantity,price:g.selling_price})),discount_percentage:k.value,discount_amount:$.value,adjust_amount:U.value,payable_amount:l.value,payment:{amount:f.value,method:w.value,remarks:j.value}});M.push({name:"OrderDetails",params:{id:s.id}}),J()}catch(s){p.value=((t=(o=s.response)==null?void 0:o.data)==null?void 0:t.message)||"Failed to create order"}finally{m.value=!1}},J=()=>{r.value=null,n.value=[],d.value=0,b.value=0,k.value=0,U.value=0,f.value=0,w.value="",j.value="",S.value&&S.value.reset()},I=o=>{r.value=o.id,console.log("Selected User:",o)},V=a(""),z=A(()=>v.value.filter(o=>!n.value.some(t=>t.id===o.id))),G=()=>{V.value&&(K(V.value),V.value=null)};return(o,t)=>(u(),i("div",be,[t[28]||(t[28]=e("h1",{class:"text-2xl font-bold mb-4"},"à¦…à¦°à§à¦¡à¦¾à¦° à¦¤à§ˆà¦°à§€ à¦•à¦°à§à¦¨",-1)),p.value?(u(),i("div",ge,y(p.value),1)):D("",!0),e("div",_e,[e("div",null,[t[6]||(t[6]=e("p",{class:"font-bold"},"à¦•à§à¦°à§‡à¦¤à¦¾à¦° à¦¤à¦¥à§à¦¯",-1)),Y(xe,{ref_key:"userSearch",ref:S,onUserCreated:I,onUserSelected:I},null,512)]),e("div",null,[t[8]||(t[8]=e("label",{class:"block text-sm font-medium mb-2"},"à¦ªà¦£à§à¦¯ à¦¨à¦¿à¦°à§à¦¬à¦¾à¦šà¦¨ à¦•à¦°à§à¦¨",-1)),_(e("select",{"onUpdate:modelValue":t[0]||(t[0]=s=>V.value=s),class:"w-full p-2 border rounded",onChange:G},[t[7]||(t[7]=e("option",{value:"",disabled:""},"à¦ªà¦£à§à¦¯ à¦¨à¦¿à¦°à§à¦¬à¦¾à¦šà¦¨ à¦•à¦°à§à¦¨",-1)),(u(!0),i(F,null,T(z.value,s=>(u(),i("option",{key:s.id,value:s},y(s.name)+" - à§³"+y(s.selling_price),9,he))),128))],544),[[L,V.value]])]),t[27]||(t[27]=e("h3",{class:"text-lg font-medium text-center"},"à¦¨à¦¿à¦°à§à¦¬à¦¾à¦šà¦¿à¦¤ à¦ªà¦£à§à¦¯",-1)),n.value.length>0?(u(),i("div",ke,[(u(!0),i(F,null,T(n.value,s=>(u(),i("div",{key:s.id,class:"border rounded-lg p-4 bg-gray-50 grid md:grid-cols-2 gap-4"},[e("div",we,[e("img",{src:s.photo,alt:"",class:"w-10"},null,8,Ue),e("div",null,[e("h4",Ce,y(s.name),1),e("p",Pe,[t[9]||(t[9]=e("span",{class:"font-medium"},"à¦¬à¦¿à¦•à§à¦°à§Ÿ à¦®à§‚à¦²à§à¦¯:",-1)),Z(" à§³"+y(Number(s.selling_price).toLocaleString("bn-BD")),1)])])]),e("div",$e,[e("div",je,[t[12]||(t[12]=e("p",{class:"text-sm font-medium text-gray-600"},"Quantity:",-1)),e("div",De,[e("button",{class:"btn-icon",onClick:g=>O(s.id,Math.max(s.quantity-1,1)),disabled:s.quantity<=1},t[10]||(t[10]=[e("i",{class:"fas fa-minus"},null,-1)]),8,Se),e("input",{type:"number",class:"w-14 text-center py-1 rounded border",value:s.quantity,onInput:g=>O(s.id,Math.max(g.target.value,1))},null,40,Ve),e("button",{class:"btn-icon",onClick:g=>O(s.id,s.quantity+1)},t[11]||(t[11]=[e("i",{class:"fas fa-plus"},null,-1)]),8,Ae)])]),e("div",Me,[t[13]||(t[13]=e("p",{class:"text-sm font-medium text-gray-600"},"Total:",-1)),e("p",qe," à§³"+y(s.quantity*s.selling_price),1)]),e("button",{class:"btn-icon",onClick:g=>R(s.id)},t[14]||(t[14]=[e("i",{class:"fas fa-trash text-red-500"},null,-1)]),8,Be)])]))),128))])):(u(),i("div",Oe,t[15]||(t[15]=[e("p",null,"à¦•à§‹à¦¨ à¦ªà¦£à§à¦¯ à¦¸à¦¿à¦²à§‡à¦•à§à¦Ÿ à¦•à¦°à¦¾ à¦¨à§‡à¦‡",-1)]))),e("div",Fe,[e("div",Te,[t[16]||(t[16]=e("p",{class:"text-sm font-medium text-gray-600 mb-1"},"Remarks",-1)),_(e("textarea",{"onUpdate:modelValue":t[1]||(t[1]=s=>j.value=s),placeholder:"Enter remarks",class:"w-full p-2 bg-gray-50 rounded-md border"},null,512),[[P,j.value]])]),e("div",Ie,[e("div",Ne,[t[17]||(t[17]=e("label",{class:"text-sm font-medium text-gray-600 mb-1"},"Discount Percentage (%)",-1)),_(e("input",{list:"discount-options","onUpdate:modelValue":t[2]||(t[2]=s=>k.value=s),type:"number",class:"bg-gray-50 p-1 border",placeholder:"Discount %"},null,512),[[P,k.value]]),e("datalist",Le,[(u(),i(F,null,T(h,s=>e("option",{key:s,value:s},null,8,Ee)),64))])]),t[26]||(t[26]=e("h3",{class:"text-xl font-semibold mb-4 text-gray-800 pt-4"},"Payment Details",-1)),e("div",Ke,[t[18]||(t[18]=e("p",{class:"text-sm font-medium text-gray-600 mb-1"},"Total Price",-1)),e("p",Re,"à§³ "+y(d.value),1)]),e("div",Qe,[t[19]||(t[19]=e("p",{class:"text-sm font-medium text-gray-600 mb-1"},"Discount Amount",-1)),e("p",Je,"à§³ "+y($.value),1)]),e("div",ze,[t[20]||(t[20]=e("p",{class:"text-sm font-medium text-gray-600 mb-1"},"Payable Amount",-1)),e("p",Ge,"à§³ "+y(l.value),1)]),e("div",He,[t[21]||(t[21]=e("label",{class:"text-sm font-medium text-gray-600 mb-1"},"Payment Amount",-1)),_(e("input",{type:"number","onUpdate:modelValue":t[3]||(t[3]=s=>f.value=s),class:"text-end bg-gray-50 p-1 w-[100px] border",placeholder:"Amount"},null,512),[[P,f.value]])]),e("div",We,[t[22]||(t[22]=e("p",{class:"text-sm font-medium text-gray-600 mb-1"},"Due Amount",-1)),e("p",Xe,"à§³ "+y(c.value),1)]),e("div",Ye,[t[24]||(t[24]=e("label",{class:"text-sm font-medium text-gray-600 mb-1"},"Payment Method",-1)),_(e("select",{"onUpdate:modelValue":t[4]||(t[4]=s=>w.value=s),class:"bg-gray-100 p-1"},t[23]||(t[23]=[e("option",{value:"Cash"},"Cash",-1),e("option",{value:"Card"},"Card",-1),e("option",{value:"Mobile Banking"},"Mobile Banking",-1),e("option",{value:"Other"},"Other",-1)]),512),[[L,w.value]])]),e("div",Ze,[t[25]||(t[25]=e("p",{class:"text-sm font-medium text-gray-600 mb-1"},"Adjustment",-1)),_(e("input",{type:"number","onUpdate:modelValue":t[5]||(t[5]=s=>U.value=s),class:"text-end bg-gray-50 p-1 w-[100px] border",placeholder:"Adjustment"},null,512),[[P,U.value]])])])]),e("div",et,[e("button",{onClick:Q,class:"btn-2",disabled:!r.value||n.value.length===0||f.value<0||!w.value}," Create Order & Add Payment ",8,tt)])])]))}};export{ot as default};
