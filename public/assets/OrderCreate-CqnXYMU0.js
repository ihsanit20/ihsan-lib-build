import{r as u,c as r,o as i,b as e,a as A,l as k,s as S,O as N,t as x,f as q,F,h as T,J as G,k as H,q as W,e as I,K as X,n as Y,i as Z,p as ee}from"./vue-DFkF7ryY.js";import{u as te}from"./user-gOHryuSU.js";import{u as se}from"./order-BI28_vEU.js";import{d as le}from"./index-DgqlB-jz.js";import"./vendor-BtuGy7By.js";const ae={class:"grid gap-2 p-4 bg-gray-100 rounded-md border"},oe={class:"grid md:grid-cols-7 gap-2"},ne={class:"relative"},ue={key:0,class:"fas fa-search"},re={key:1,class:"fad fa-spinner animate-spin"},ie={class:"md:col-span-2"},de={class:"relative"},ce={key:0,class:"fas fa-search"},ve={key:1,class:"fad fa-spinner animate-spin"},me={class:"md:col-span-4"},pe={key:0,class:"text-green-500 text-center text-sm"},fe={key:1,class:"text-red-500 text-center text-sm"},ye={key:2,class:"flex flex-col justify-center items-center gap-2"},xe={key:1,class:"fad fa-spinner animate-spin text-white"},be={__name:"UserSearch",emits:["user-selected","user-created"],setup(M,{expose:D,emit:g}){const f=te(),y=u(!1),n=u(""),c=u(""),m=u(""),p=u(""),o=u(""),a=u(""),_=u("search"),w=u(null),C=g,j=()=>{m.value="",p.value="",o.value="",a.value="",_.value="create",n.value="",c.value=""},b=async()=>{y.value=!0,n.value="",c.value="";try{const l=await f.searchUser({id:m.value});(l==null?void 0:l.status)==="found"?($(f.user),n.value="ক্রেতা পাওয়া গেছে!😍",C("user-selected",f.user)):(c.value="ক্রেতা পাওয়া যায়নি!😢 ক্রেতা তৈরী করুন",m.value="",o.value="",a.value="",_.value="create")}catch(l){c.value="ত্রুটি পাওয়া গেছে!😭",console.error("ত্রুটি পাওয়া গেছে!😭",l)}finally{y.value=!1}},U=async()=>{y.value=!0,n.value="",c.value="";try{const l=await f.searchUser({phone:p.value});(l==null?void 0:l.status)==="found"?($(f.user),n.value="ক্রেতা পাওয়া গেছে!😍",C("user-selected",f.user)):(c.value="ক্রেতা পাওয়া যায়নি!😢 ক্রেতা তৈরী করুন",m.value="",o.value="",a.value="",_.value="create")}catch(l){c.value="ত্রুটি পাওয়া গেছে!😭",console.error("ত্রুটি পাওয়া গেছে!😭",l),_.value="create"}finally{y.value=!1}},V=async()=>{y.value=!0,n.value="",c.value="",w.value=null;try{const l={phone:p.value,name:o.value,address:a.value},v=await f.addUser(l);$(v),w.value=v,n.value="সফলভাবে ক্রেতা তৈরি হয়েছে!🤩",C("user-created",v),_.value="edit"}catch(l){c.value=(l==null?void 0:l.message)||"ক্রেতা তৈরি করা যায়নি!😢",console.error("Error:",l)}finally{y.value=!1}},$=l=>{m.value=l.id||"",p.value=l.phone||"",o.value=l.name||"",a.value=l.address||"",_.value="edit"};return D({resetForm:j}),(l,v)=>(i(),r("div",ae,[e("div",oe,[e("div",null,[e("div",ne,[k(e("input",{"onUpdate:modelValue":v[0]||(v[0]=P=>m.value=P),type:"text",class:"input-1 w-full text-black px-3 py-1",placeholder:"ID",onKeyup:N(b,["enter"])},null,544),[[S,m.value]]),m.value?(i(),r("button",{key:0,onClick:b,class:"absolute right-3 top-2"},[y.value?(i(),r("i",re)):(i(),r("i",ue))])):A("",!0)])]),e("div",ie,[e("div",de,[k(e("input",{"onUpdate:modelValue":v[1]||(v[1]=P=>p.value=P),type:"text",class:"input-1 w-full text-black px-3 py-1",placeholder:"ফোন",onKeyup:N(U,["enter"])},null,544),[[S,p.value]]),p.value?(i(),r("button",{key:0,onClick:U,class:"absolute right-3 top-2"},[y.value?(i(),r("i",ve)):(i(),r("i",ce))])):A("",!0)])]),e("div",me,[k(e("input",{"onUpdate:modelValue":v[2]||(v[2]=P=>o.value=P),type:"text",placeholder:"নাম",class:"input-1 w-full text-black px-3 py-1"},null,512),[[S,o.value]])])]),e("div",null,[k(e("input",{"onUpdate:modelValue":v[3]||(v[3]=P=>a.value=P),type:"text",placeholder:"ঠিকানা",class:"input-1 w-full text-black px-3 py-1"},null,512),[[S,a.value]])]),n.value?(i(),r("div",pe,x(n.value),1)):A("",!0),c.value?(i(),r("div",fe,x(c.value),1)):A("",!0),_.value==="create"?(i(),r("div",ye,[y.value?(i(),r("i",xe)):(i(),r("button",{key:0,class:"btn-2",onClick:V},"Create User"))])):A("",!0)]))}},ge={class:"relative w-full"},_e={key:0,class:"absolute z-10 w-full bg-white border rounded shadow max-h-60 overflow-y-auto"},he=["onClick"],ke={__name:"SearchableDropdown",props:{products:{type:Array,required:!0},onSelect:{type:Function,default:()=>{}}},setup(M){const D=M,g=u(""),f=u(!1);function y(p){const o={"০":"0","১":"1","২":"2","৩":"3","৪":"4","৫":"5","৬":"6","৭":"7","৮":"8","৯":"9"};return p.replace(/[০-৯]/g,a=>o[a])}const n=q(()=>(g.value?D.products.filter(o=>{const a=y(g.value);return parseInt(o.id)===parseInt(a)||o.name.toLowerCase().includes(g.value.toLowerCase())}):D.products).sort((o,a)=>o.id-a.id));function c(p){D.onSelect(p),g.value="",f.value=!1}function m(){setTimeout(()=>f.value=!1,200)}return(p,o)=>(i(),r("div",ge,[o[2]||(o[2]=e("label",{class:"block text-sm font-medium mb-2"},"পণ্য নির্বাচন করুন",-1)),k(e("input",{type:"text","onUpdate:modelValue":o[0]||(o[0]=a=>g.value=a),onFocus:o[1]||(o[1]=a=>f.value=!0),onBlur:m,placeholder:"পণ্য সার্চ করুন...",class:"w-full p-2 border rounded"},null,544),[[S,g.value]]),f.value&&n.value.length?(i(),r("ul",_e,[(i(!0),r(F,null,T(n.value,a=>(i(),r("li",{key:a.id,onClick:G(_=>c(a),["self"]),class:"p-2 cursor-pointer hover:bg-gray-100"},x(a.id)+" | "+x(a.name)+" - ৳"+x(a.selling_price),9,he))),128))])):A("",!0)]))}},we={class:"my-container space-y-4"},Ce={key:0,class:"text-red-600 text-center"},Ue={class:"bg-white shadow p-4 rounded-lg space-y-4"},$e={key:0,class:"grid gap-2"},Pe={class:"flex items-center gap-4"},Se=["src"],De={class:"text-lg font-semibold text-gray-800 mb-2"},Ae={class:"text-sm text-gray-600"},je={class:"flex justify-between items-center"},Ve={class:"flex flex-col items-center"},qe={class:"flex items-center gap-2"},Me=["onClick","disabled"],Oe=["value","onInput"],Be=["onClick"],Fe={class:"flex flex-col items-end"},Te={class:"text-lg font-bold text-gray-800"},Le=["onClick"],Ne={key:1,class:"text-center text-red-500 text-sm bg-gray-50 p-4 rounded-lg border"},Ie={class:"grid md:grid-cols-2 gap-4"},Ee={class:""},Ke={class:"divide-y"},Qe={class:"flex justify-between items-center"},Re={id:"discount-options"},ze=["value"],Je={class:"flex justify-between items-center"},Ge={class:"text-lg font-semibold text-gray-800"},He={class:"flex justify-between items-center"},We={class:"text-lg font-semibold text-violet-600"},Xe={class:"flex justify-between items-center"},Ye={class:"text-lg font-semibold text-blue-600"},Ze={class:"flex justify-between items-center"},et={class:"flex justify-between items-center"},tt={class:"text-lg font-semibold text-red-600"},st={class:"flex justify-between items-center"},lt={class:"flex justify-between items-center"},at={class:"flex flex-col items-center"},ot=["disabled"],nt="offline",vt={__name:"OrderCreate",setup(M){const D=Z(),g=se(),f=le(),y=u([]),n=u([]),c=u(""),m=u(0),p=u(0),o=u(!1),a=u(null),_=[0,5,10,12,15,20,25,30,35,40,45,50],w=u(0),C=u("Cash"),j=u(""),b=u(0),U=u(0),V=u(null),$=u(!1),l=q(()=>m.value*w.value/100),v=q(()=>m.value-l.value-U.value),P=q(()=>{const d=p.value+b.value,t=v.value-d;return t>0?t:0}),E=async()=>{try{o.value=!0,await f.fetchProducts(),y.value=f.products}catch(d){a.value=d.message}finally{o.value=!1}};H(()=>{E(),b.value=v.value}),W([w,U],()=>{b.value=v.value});const O=()=>{m.value=n.value.reduce((d,t)=>d+t.quantity*t.selling_price,0)},K=d=>{n.value.find(t=>t.id===d.id)||(n.value.push({...d,quantity:1}),O())},B=(d,t)=>{const s=n.value.find(h=>h.id===d);s&&(s.quantity=t,O())},Q=d=>{n.value=n.value.filter(t=>t.id!==d),O()},R=async()=>{var d,t;if(console.log("submitOrder........"),!$.value){console.log("order submitting...");try{$.value=!0,o.value=!0;const s=await g.createOrder({user_id:c.value,type:nt,products:n.value.map(h=>({product_id:h.id,quantity:h.quantity,price:h.selling_price})),discount_percentage:w.value,discount_amount:l.value,adjust_amount:U.value,payable_amount:v.value,payment:{amount:b.value,method:C.value,remarks:j.value}});D.push({name:"OrderDetails",params:{id:s.id}}),z()}catch(s){a.value=((t=(d=s.response)==null?void 0:d.data)==null?void 0:t.message)||"Failed to create order"}finally{o.value=!1,$.value=!1}}},z=()=>{c.value=null,n.value=[],m.value=0,p.value=0,w.value=0,U.value=0,b.value=0,C.value="",j.value="",V.value&&V.value.reset()},L=d=>{c.value=d.id,console.log("Selected User:",d)},J=q(()=>y.value.filter(d=>!n.value.some(t=>t.id===d.id)));return(d,t)=>(i(),r("div",we,[t[25]||(t[25]=e("h1",{class:"text-2xl font-bold mb-4"},"অর্ডার তৈরী করুন",-1)),a.value?(i(),r("div",Ce,x(a.value),1)):A("",!0),e("div",Ue,[e("div",null,[t[5]||(t[5]=e("p",{class:"font-bold"},"ক্রেতার তথ্য",-1)),I(be,{ref_key:"userSearch",ref:V,onUserCreated:L,onUserSelected:L},null,512)]),I(ke,{products:J.value,onSelect:s=>{K(s)}},null,8,["products","onSelect"]),t[24]||(t[24]=e("h3",{class:"text-lg font-medium text-center"},"নির্বাচিত পণ্য",-1)),n.value.length>0?(i(),r("div",$e,[(i(!0),r(F,null,T(n.value,s=>(i(),r("div",{key:s.id,class:"border rounded-lg p-2 bg-gray-50 grid md:grid-cols-2 gap-4"},[e("div",Pe,[e("img",{src:s.photo,alt:"",class:"w-12 shadow-sm rounded-md"},null,8,Se),e("div",null,[e("h4",De,x(s.name),1),e("p",Ae,[t[6]||(t[6]=e("span",{class:"font-medium"},"বিক্রয় মূল্য:",-1)),ee(" ৳"+x(Number(s.selling_price).toLocaleString("bn-BD")),1)])])]),e("div",je,[e("div",Ve,[t[9]||(t[9]=e("p",{class:"text-sm font-medium text-gray-600"},"Quantity:",-1)),e("div",qe,[e("button",{class:"btn-icon",onClick:h=>B(s.id,Math.max(s.quantity-1,1)),disabled:s.quantity<=1},t[7]||(t[7]=[e("i",{class:"fas fa-minus"},null,-1)]),8,Me),e("input",{type:"number",class:"w-14 text-center py-1 rounded border",value:s.quantity,onInput:h=>B(s.id,Math.max(h.target.value,1))},null,40,Oe),e("button",{class:"btn-icon",onClick:h=>B(s.id,s.quantity+1)},t[8]||(t[8]=[e("i",{class:"fas fa-plus"},null,-1)]),8,Be)])]),e("div",Fe,[t[10]||(t[10]=e("p",{class:"text-sm font-medium text-gray-600"},"Total:",-1)),e("p",Te," ৳"+x(s.quantity*s.selling_price),1)]),e("button",{class:"btn-icon",onClick:h=>Q(s.id)},t[11]||(t[11]=[e("i",{class:"fas fa-trash text-red-500"},null,-1)]),8,Le)])]))),128))])):(i(),r("div",Ne,t[12]||(t[12]=[e("p",null,"কোন পণ্য সিলেক্ট করা নেই",-1)]))),e("div",Ie,[e("div",Ee,[t[13]||(t[13]=e("p",{class:"text-sm font-medium text-gray-600 mb-1"},"Remarks",-1)),k(e("textarea",{"onUpdate:modelValue":t[0]||(t[0]=s=>j.value=s),placeholder:"Enter remarks",class:"w-full p-2 bg-gray-50 rounded-md border"},null,512),[[S,j.value]])]),e("div",Ke,[e("div",Qe,[t[14]||(t[14]=e("label",{class:"text-sm font-medium text-gray-600 mb-1"},"Discount Percentage (%)",-1)),k(e("input",{list:"discount-options","onUpdate:modelValue":t[1]||(t[1]=s=>w.value=s),type:"number",class:"bg-gray-50 p-1 border",placeholder:"Discount %"},null,512),[[S,w.value]]),e("datalist",Re,[(i(),r(F,null,T(_,s=>e("option",{key:s,value:s},null,8,ze)),64))])]),t[23]||(t[23]=e("h3",{class:"text-xl font-semibold mb-4 text-gray-800 pt-4"},"Payment Details",-1)),e("div",Je,[t[15]||(t[15]=e("p",{class:"text-sm font-medium text-gray-600 mb-1"},"Total Price",-1)),e("p",Ge,"৳ "+x(m.value),1)]),e("div",He,[t[16]||(t[16]=e("p",{class:"text-sm font-medium text-gray-600 mb-1"},"Discount Amount",-1)),e("p",We,"৳ "+x(l.value),1)]),e("div",Xe,[t[17]||(t[17]=e("p",{class:"text-sm font-medium text-gray-600 mb-1"},"Payable Amount",-1)),e("p",Ye,"৳ "+x(v.value),1)]),e("div",Ze,[t[18]||(t[18]=e("label",{class:"text-sm font-medium text-gray-600 mb-1"},"Payment Amount",-1)),k(e("input",{type:"number","onUpdate:modelValue":t[2]||(t[2]=s=>b.value=s),class:"text-end bg-gray-50 p-1 w-[100px] border",placeholder:"Amount"},null,512),[[S,b.value]])]),e("div",et,[t[19]||(t[19]=e("p",{class:"text-sm font-medium text-gray-600 mb-1"},"Due Amount",-1)),e("p",tt,"৳ "+x(P.value),1)]),e("div",st,[t[21]||(t[21]=e("label",{class:"text-sm font-medium text-gray-600 mb-1"},"Payment Method",-1)),k(e("select",{"onUpdate:modelValue":t[3]||(t[3]=s=>C.value=s),class:"bg-gray-100 p-1"},t[20]||(t[20]=[e("option",{value:"Cash"},"Cash",-1),e("option",{value:"Card"},"Card",-1),e("option",{value:"Mobile Banking"},"Mobile Banking",-1),e("option",{value:"Other"},"Other",-1)]),512),[[X,C.value]])]),e("div",lt,[t[22]||(t[22]=e("p",{class:"text-sm font-medium text-gray-600 mb-1"},"Adjustment",-1)),k(e("input",{type:"number","onUpdate:modelValue":t[4]||(t[4]=s=>U.value=s),class:"text-end bg-gray-50 p-1 w-[100px] border",placeholder:"Adjustment"},null,512),[[S,U.value]])])])]),e("div",at,[e("button",{onClick:R,class:Y(["btn-2 disabled:opacity-50",$.value?"disabled:cursor-wait":"disabled:cursor-not-allowed"]),disabled:!c.value||n.value.length===0||b.value<0||!C.value||$.value}," Create Order & Add Payment ",10,ot)])])]))}};export{vt as default};
