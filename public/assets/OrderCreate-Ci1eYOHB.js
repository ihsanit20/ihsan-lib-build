import{r as a,c as u,o as i,b as e,a as S,l as _,s as P,N as I,t as y,f as A,k as J,m as W,e as X,K,F,h as N,i as Y,q as Z}from"./vue-D0mF8XVW.js";import{u as ee}from"./user-5-47J9fY.js";import{u as te}from"./order-7fKY9cva.js";import{d as se}from"./index-Czyahqyo.js";import"./vendor-BtuGy7By.js";const le={class:"grid gap-2 p-4 bg-gray-100 rounded-md border"},ae={class:"grid md:grid-cols-7 gap-2"},ne={class:"relative"},oe={key:0,class:"fas fa-search"},ue={key:1,class:"fad fa-spinner animate-spin"},ie={class:"md:col-span-2"},re={class:"relative"},de={key:0,class:"fas fa-search"},ce={key:1,class:"fad fa-spinner animate-spin"},ve={class:"md:col-span-4"},me={key:0,class:"text-green-500 text-center text-sm"},pe={key:1,class:"text-red-500 text-center text-sm"},ye={key:2,class:"flex flex-col justify-center items-center gap-2"},fe={key:1,class:"fad fa-spinner animate-spin text-white"},xe={__name:"UserSearch",emits:["user-selected","user-created"],setup(L,{expose:q,emit:M}){const x=ee(),v=a(!1),n=a(""),r=a(""),d=a(""),b=a(""),m=a(""),p=a(""),h=a("search"),k=a(null),w=M,D=()=>{d.value="",b.value="",m.value="",p.value="",h.value="create",n.value="",r.value=""},f=async()=>{v.value=!0,n.value="",r.value="";try{const l=await x.searchUser({id:d.value});(l==null?void 0:l.status)==="found"?($(x.user),n.value="ক্রেতা পাওয়া গেছে!😍",w("user-selected",x.user)):(r.value="ক্রেতা পাওয়া যায়নি!😢 ক্রেতা তৈরী করুন",d.value="",m.value="",p.value="",h.value="create")}catch(l){r.value="ত্রুটি পাওয়া গেছে!😭",console.error("ত্রুটি পাওয়া গেছে!😭",l)}finally{v.value=!1}},U=async()=>{v.value=!0,n.value="",r.value="";try{const l=await x.searchUser({phone:b.value});(l==null?void 0:l.status)==="found"?($(x.user),n.value="ক্রেতা পাওয়া গেছে!😍",w("user-selected",x.user)):(r.value="ক্রেতা পাওয়া যায়নি!😢 ক্রেতা তৈরী করুন",d.value="",m.value="",p.value="",h.value="create")}catch(l){r.value="ত্রুটি পাওয়া গেছে!😭",console.error("ত্রুটি পাওয়া গেছে!😭",l),h.value="create"}finally{v.value=!1}},j=async()=>{v.value=!0,n.value="",r.value="",k.value=null;try{const l={phone:b.value,name:m.value,address:p.value},c=await x.addUser(l);$(c),k.value=c,n.value="সফলভাবে ক্রেতা তৈরি হয়েছে!🤩",w("user-created",c),h.value="edit"}catch(l){r.value=(l==null?void 0:l.message)||"ক্রেতা তৈরি করা যায়নি!😢",console.error("Error:",l)}finally{v.value=!1}},$=l=>{d.value=l.id||"",b.value=l.phone||"",m.value=l.name||"",p.value=l.address||"",h.value="edit"};return q({resetForm:D}),(l,c)=>(i(),u("div",le,[e("div",ae,[e("div",null,[e("div",ne,[_(e("input",{"onUpdate:modelValue":c[0]||(c[0]=C=>d.value=C),type:"text",class:"input-1 w-full text-black px-3 py-1",placeholder:"ID",onKeyup:I(f,["enter"])},null,544),[[P,d.value]]),d.value?(i(),u("button",{key:0,onClick:f,class:"absolute right-3 top-2"},[v.value?(i(),u("i",ue)):(i(),u("i",oe))])):S("",!0)])]),e("div",ie,[e("div",re,[_(e("input",{"onUpdate:modelValue":c[1]||(c[1]=C=>b.value=C),type:"text",class:"input-1 w-full text-black px-3 py-1",placeholder:"ফোন",onKeyup:I(U,["enter"])},null,544),[[P,b.value]]),b.value?(i(),u("button",{key:0,onClick:U,class:"absolute right-3 top-2"},[v.value?(i(),u("i",ce)):(i(),u("i",de))])):S("",!0)])]),e("div",ve,[_(e("input",{"onUpdate:modelValue":c[2]||(c[2]=C=>m.value=C),type:"text",placeholder:"নাম",class:"input-1 w-full text-black px-3 py-1"},null,512),[[P,m.value]])])]),e("div",null,[_(e("input",{"onUpdate:modelValue":c[3]||(c[3]=C=>p.value=C),type:"text",placeholder:"ঠিকানা",class:"input-1 w-full text-black px-3 py-1"},null,512),[[P,p.value]])]),n.value?(i(),u("div",me,y(n.value),1)):S("",!0),r.value?(i(),u("div",pe,y(r.value),1)):S("",!0),h.value==="create"?(i(),u("div",ye,[v.value?(i(),u("i",fe)):(i(),u("button",{key:0,class:"btn-2",onClick:j},"Create User"))])):S("",!0)]))}},be={class:"my-container space-y-4"},ge={key:0,class:"text-red-600 text-center"},_e={class:"bg-white shadow p-4 rounded-lg space-y-4"},he=["value"],ke={key:0,class:"grid gap-2"},we={class:"flex items-center gap-4"},Ue=["src"],Ce={class:"text-lg font-semibold text-gray-800 mb-2"},Pe={class:"text-sm text-gray-600"},$e={class:"flex justify-between items-center"},De={class:"flex flex-col items-center"},Se={class:"flex items-center gap-2"},je=["onClick","disabled"],Ve=["value","onInput"],Ae=["onClick"],qe={class:"flex flex-col items-end"},Me={class:"text-lg font-bold text-gray-800"},Oe=["onClick"],Be={key:1,class:"text-center text-red-500 text-sm bg-gray-50 p-4 rounded-lg border"},Fe={class:"grid md:grid-cols-2 gap-4"},Ne={class:""},Te={class:"divide-y"},Ie={class:"flex justify-between items-center"},Ke={id:"discount-options"},Le=["value"],Ee={class:"flex justify-between items-center"},Re={class:"text-lg font-semibold text-gray-800"},Qe={class:"flex justify-between items-center"},ze={class:"text-lg font-semibold text-violet-600"},Ge={class:"flex justify-between items-center"},He={class:"text-lg font-semibold text-blue-600"},Je={class:"flex justify-between items-center"},We={class:"flex justify-between items-center"},Xe={class:"text-lg font-semibold text-red-600"},Ye={class:"flex justify-between items-center"},Ze={class:"flex justify-between items-center"},et={class:"flex flex-col items-center"},tt=["disabled"],st="offline",it={__name:"OrderCreate",setup(L){const q=Y(),M=te(),x=se(),v=a([]),n=a([]),r=a(""),d=a(0),b=a(0),m=a(!1),p=a(null),h=[0,5,10,12,15,20,25,30,35,40,45,50],k=a(0),w=a("Cash"),D=a(""),f=a(0),U=a(0),j=a(null),$=A(()=>d.value*k.value/100),l=A(()=>d.value-$.value-U.value),c=A(()=>{const o=b.value+f.value,t=l.value-o;return t>0?t:0}),C=async()=>{try{m.value=!0,await x.fetchProducts(),v.value=x.products}catch(o){p.value=o.message}finally{m.value=!1}};J(()=>{C(),f.value=l.value}),W([k,U],()=>{f.value=l.value});const O=()=>{d.value=n.value.reduce((o,t)=>o+t.quantity*t.selling_price,0)},E=o=>{n.value.find(t=>t.id===o.id)||(n.value.push({...o,quantity:1}),O())},B=(o,t)=>{const s=n.value.find(g=>g.id===o);s&&(s.quantity=t,O())},R=o=>{n.value=n.value.filter(t=>t.id!==o),O()},Q=async()=>{var o,t;try{m.value=!0;const s=await M.createOrder({user_id:r.value,type:st,products:n.value.map(g=>({product_id:g.id,quantity:g.quantity,price:g.selling_price})),discount_percentage:k.value,discount_amount:$.value,adjust_amount:U.value,payable_amount:l.value,payment:{amount:f.value,method:w.value,remarks:D.value}});q.push({name:"OrderDetails",params:{id:s.id}}),z()}catch(s){p.value=((t=(o=s.response)==null?void 0:o.data)==null?void 0:t.message)||"Failed to create order"}finally{m.value=!1}},z=()=>{r.value=null,n.value=[],d.value=0,b.value=0,k.value=0,U.value=0,f.value=0,w.value="",D.value="",j.value&&j.value.reset()},T=o=>{r.value=o.id,console.log("Selected User:",o)},V=a(""),G=A(()=>v.value.filter(o=>!n.value.some(t=>t.id===o.id))),H=()=>{V.value&&(E(V.value),V.value=null)};return(o,t)=>(i(),u("div",be,[t[28]||(t[28]=e("h1",{class:"text-2xl font-bold mb-4"},"অর্ডার তৈরী করুন",-1)),p.value?(i(),u("div",ge,y(p.value),1)):S("",!0),e("div",_e,[e("div",null,[t[6]||(t[6]=e("p",{class:"font-bold"},"ক্রেতার তথ্য",-1)),X(xe,{ref_key:"userSearch",ref:j,onUserCreated:T,onUserSelected:T},null,512)]),e("div",null,[t[8]||(t[8]=e("label",{class:"block text-sm font-medium mb-2"},"পণ্য নির্বাচন করুন",-1)),_(e("select",{"onUpdate:modelValue":t[0]||(t[0]=s=>V.value=s),class:"w-full p-2 border rounded",onChange:H},[t[7]||(t[7]=e("option",{value:"",disabled:""},"পণ্য নির্বাচন করুন",-1)),(i(!0),u(F,null,N(G.value,s=>(i(),u("option",{key:s.id,value:s},y(s.name)+" - ৳"+y(s.selling_price),9,he))),128))],544),[[K,V.value]])]),t[27]||(t[27]=e("h3",{class:"text-lg font-medium text-center"},"নির্বাচিত পণ্য",-1)),n.value.length>0?(i(),u("div",ke,[(i(!0),u(F,null,N(n.value,s=>(i(),u("div",{key:s.id,class:"border rounded-lg p-4 bg-gray-50 grid md:grid-cols-2 gap-4"},[e("div",we,[e("img",{src:s.photo,alt:"",class:"w-10"},null,8,Ue),e("div",null,[e("h4",Ce,y(s.name),1),e("p",Pe,[t[9]||(t[9]=e("span",{class:"font-medium"},"বিক্রয় মূল্য:",-1)),Z(" ৳"+y(Number(s.selling_price).toLocaleString("bn-BD")),1)])])]),e("div",$e,[e("div",De,[t[12]||(t[12]=e("p",{class:"text-sm font-medium text-gray-600"},"Quantity:",-1)),e("div",Se,[e("button",{class:"btn-icon",onClick:g=>B(s.id,Math.max(s.quantity-1,1)),disabled:s.quantity<=1},t[10]||(t[10]=[e("i",{class:"fas fa-minus"},null,-1)]),8,je),e("input",{type:"number",class:"w-14 text-center py-1 rounded border",value:s.quantity,onInput:g=>B(s.id,Math.max(g.target.value,1))},null,40,Ve),e("button",{class:"btn-icon",onClick:g=>B(s.id,s.quantity+1)},t[11]||(t[11]=[e("i",{class:"fas fa-plus"},null,-1)]),8,Ae)])]),e("div",qe,[t[13]||(t[13]=e("p",{class:"text-sm font-medium text-gray-600"},"Total:",-1)),e("p",Me," ৳"+y(s.quantity*s.selling_price),1)]),e("button",{class:"btn-icon",onClick:g=>R(s.id)},t[14]||(t[14]=[e("i",{class:"fas fa-trash text-red-500"},null,-1)]),8,Oe)])]))),128))])):(i(),u("div",Be,t[15]||(t[15]=[e("p",null,"কোন পণ্য সিলেক্ট করা নেই",-1)]))),e("div",Fe,[e("div",Ne,[t[16]||(t[16]=e("p",{class:"text-sm font-medium text-gray-600 mb-1"},"Remarks",-1)),_(e("textarea",{"onUpdate:modelValue":t[1]||(t[1]=s=>D.value=s),placeholder:"Enter remarks",class:"w-full p-2 bg-gray-50 rounded-md border"},null,512),[[P,D.value]])]),e("div",Te,[e("div",Ie,[t[17]||(t[17]=e("label",{class:"text-sm font-medium text-gray-600 mb-1"},"Discount Percentage (%)",-1)),_(e("input",{list:"discount-options","onUpdate:modelValue":t[2]||(t[2]=s=>k.value=s),type:"number",class:"bg-gray-50 p-1 border",placeholder:"Discount %"},null,512),[[P,k.value]]),e("datalist",Ke,[(i(),u(F,null,N(h,s=>e("option",{key:s,value:s},null,8,Le)),64))])]),t[26]||(t[26]=e("h3",{class:"text-xl font-semibold mb-4 text-gray-800 pt-4"},"Payment Details",-1)),e("div",Ee,[t[18]||(t[18]=e("p",{class:"text-sm font-medium text-gray-600 mb-1"},"Total Price",-1)),e("p",Re,"৳ "+y(d.value),1)]),e("div",Qe,[t[19]||(t[19]=e("p",{class:"text-sm font-medium text-gray-600 mb-1"},"Discount Amount",-1)),e("p",ze,"৳ "+y($.value),1)]),e("div",Ge,[t[20]||(t[20]=e("p",{class:"text-sm font-medium text-gray-600 mb-1"},"Payable Amount",-1)),e("p",He,"৳ "+y(l.value),1)]),e("div",Je,[t[21]||(t[21]=e("label",{class:"text-sm font-medium text-gray-600 mb-1"},"Payment Amount",-1)),_(e("input",{type:"number","onUpdate:modelValue":t[3]||(t[3]=s=>f.value=s),class:"text-end bg-gray-50 p-1 w-[100px] border",placeholder:"Amount"},null,512),[[P,f.value]])]),e("div",We,[t[22]||(t[22]=e("p",{class:"text-sm font-medium text-gray-600 mb-1"},"Due Amount",-1)),e("p",Xe,"৳ "+y(c.value),1)]),e("div",Ye,[t[24]||(t[24]=e("label",{class:"text-sm font-medium text-gray-600 mb-1"},"Payment Method",-1)),_(e("select",{"onUpdate:modelValue":t[4]||(t[4]=s=>w.value=s),class:"bg-gray-100 p-1"},t[23]||(t[23]=[e("option",{value:"Cash"},"Cash",-1),e("option",{value:"Card"},"Card",-1),e("option",{value:"Mobile Banking"},"Mobile Banking",-1),e("option",{value:"Other"},"Other",-1)]),512),[[K,w.value]])]),e("div",Ze,[t[25]||(t[25]=e("p",{class:"text-sm font-medium text-gray-600 mb-1"},"Adjustment",-1)),_(e("input",{type:"number","onUpdate:modelValue":t[5]||(t[5]=s=>U.value=s),class:"text-end bg-gray-50 p-1 w-[100px] border",placeholder:"Adjustment"},null,512),[[P,U.value]])])])]),e("div",et,[e("button",{onClick:Q,class:"btn-2",disabled:!r.value||n.value.length===0||f.value<0||!w.value}," Create Order & Add Payment ",8,tt)])])]))}};export{it as default};
